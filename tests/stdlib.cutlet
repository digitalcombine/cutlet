# Test the standard library.

# Remove the system library directory path
$library.path remove 0

import stdlib

global result = 0

#=============================================================================#
# Testing try catch throw

print "Test: try catch throw"

try {
  raise "I threw an error"
  return 1
} catch err {
  if {$err == "I threw an error"} then {
    print "I caught an error ->" $err
  } else {
    print " error: I caught an unexpected error ->" $err
    return 1
  }
}

try {
  local myvar = 10
  try {
    if {$myvar != 10} then {
      print "$myvar != 10"
      return 1
    }
  } catch err {
    print "Try in blocks failed, $err"
    return 1
  }
} catch err {
  print $err
  return 1
}

#=============================================================================#
# Testing if

if {[true]} then {
} else {
  print " error: [true] failed"
  global result = 1
}

#=============================================================================#
# Testing while loops

print "Test: while"

global res = ""
while {$res <> "+++++"} do {
  global res = "${res}+"
}

if {$res <> "+++++"} then {
  print " error: \$res <> \"+++++\" ->  \"${res}\""
  global result = 1
}

global res = ""
while {$res <> "+++++"} {
  global res = "${res}+"
  if {$res == "++++"} {
    break
  }
}

if {$res <> "++++"} then {
  print " error: \$res <> \"++++\" ->  \"${res}\""
  global result = 1
}

global result = ""
while {$result < "+-+-+-++"} {
  global result = "${result}+"
  if {$result == "+-+-+-+"} {
    continue
  }
  global result = "${result}-"
}

if {$result <> "+-+-+-++-"} then {
  print "\$result <> \"+-+-+-++-\" ->  \"${result}\""
  return 1
}

return $result